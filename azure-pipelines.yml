
trigger:
  branches:
    include:
      - main

variables:
  # Docker Registry service connection (yours)
  dockerRegistryServiceConnection: 'dtcrtestregistrycentraluspoc'
  imageRepository: 'admindashboard'    # repository name in ACR (auto-creates on first push)
  dockerfilePath: 'Dockerfile'
  tags: '$(Build.BuildId)'
  vmImageName: 'ubuntu-latest'

stages:
- stage: Build
  displayName: Build and push stage
  jobs:
  - job: Build
    displayName: Build
    pool:
      vmImage: $(vmImageName)
    steps:
      # Explicit login (optional but helpful for clearer failures)
      - task: Docker@2
        displayName: 'Login to ACR'
        inputs:
          command: 'login'
          containerRegistry: dtcrtestregistrycentraluspoc

      # Build & push (the task will use your service connection and prepend the ACR login server)
      - task: Docker@2
        inputs:
          containerRegistry: 'dtcrtestregistrycentraluspoc'
          repository: 'admindashboard'
          command: 'build'
          Dockerfile: '**/Dockerfile'
          tags: '1.0.0'
      - task: Docker@2
        inputs:
          containerRegistry: 'dtcrtestregistrycentraluspoc'
          repository: 'admindashboard'
          command: 'push'
          tags: '1.0.0'